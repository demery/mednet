#!/usr/bin/env ruby
require 'mednet'
require 'csv'
require 'htmlentities'

parser = Mednet::Parser.new

count = 0
stop = 40

csv_string = CSV.generate do |csv|
  csv << %w{ Feast Attributes Modifiers Sources Line }
  ARGF.each do |line|
    if line =~ /^\s*<br>/
      data = parser.parse line
      row = []
      row << data.name
      row << data.attrs.join('|')
      row << data.mods.join('|')
      row << data.sources.join('|')
      row << HTMLEntities.new.decode(line.strip.gsub(/<[^>]*>/,''))
      csv << row
    end
  end
end

puts csv_string
